<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

    <style>
            @font-face {
      font-family: 'Qahiri';
      src: url('fonts/Qahiri-Regular.ttf') format('truetype');
    }


        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding-top: 40px; /* Adjust based on the height of the .selector */

        }
        h1, h2, h3 {
            color: #333;
        }
        .verse {
            margin-bottom: 20px;
        }
        .arabic {
            font-family: 'Qahiri', sans-serif;
      font-size: 24px;
      word-spacing: 10px;
      font-style: italic;
            font-size: 1.5em;
            direction: rtl;
            text-align: right;
        }
        .translation {
            margin-top: 10px;
            color: #555;
        }
/* Style to freeze the selector div at the top with icons */
.selector {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: white;
    z-index: 1000;
    padding: 10px;
    border-bottom: 1px solid #ccc;
    display: flex;
    align-items: center;
    justify-content: space-between;  /* Spread out the elements */
}

/* Styling for the left side (Quran icon and selectors) */
.selector-left {
    display: flex;
    align-items: center;
}

.selector-left img {
    height: 30px;
    margin-right: 10px; /* Add some space between the icon and the selectors */
}

/* Add space between the Sura and Verse dropdowns */
.selector-left label, 
.selector-left select {
    margin-right: 10px; /* Add 10px space between the Sura and Verse */
}

/* Styling for the right side (GitHub and TikTok icons) */
.selector-right {
    display: flex;
    align-items: center;
    margin-right: 20px;
}

.selector-right a {
    margin-left: 15px;
    color: #333;  /* Default color for the icons */
    font-size: 24px;
}

.selector-right a:hover {
    color: #007bff;  /* Change icon color on hover */
}

    </style>
</head>
<body>
    <div class="selector">
        <div class="selector-left">
            <!-- Quran icon -->
            <img src="icon.png" alt="Quran Icon" />
    
            <!-- Sura and Verse Selectors -->
            <label for="sura-select">Sura:</label>
            <select id="sura-select"></select>
    
            <label for="verse-select">Verse:</label>
            <select id="verse-select"></select>
        </div>
    
        <div class="selector-right">
                        <!-- Book icon -->
            <a href="https://link-to-book" target="_blank">
                <i class="fas fa-book"></i>
            </a>
            <!-- GitHub icon -->
            <a href="https://github.com/your-github-profile" target="_blank">
                <i class="fab fa-github"></i>
            </a>
    
            <!-- TikTok icon -->
            <a href="https://www.tiktok.com/@your-tiktok-profile" target="_blank">
                <i class="fab fa-tiktok"></i>
            </a>
    

        </div>
    </div>

    <div id="quran-container"></div>

    <script>
        let suraData, combinedData, wordsData;
        
        // Fetch all JSON data (sura.json, combined_quran.json, quran_words.json)
        Promise.all([
            fetch('json/sura.json').then(response => response.json()),
            fetch('json/combined_quran.json').then(response => response.json()),
            fetch('json/quran_words.json').then(response => response.json())
        ]).then(data => {
            suraData = data[0];
            combinedData = data[1];
            wordsData = data[2];
            console.log('Sura Data:', suraData);  // Log the data to make sure it loads
            console.log('Combined Data:', combinedData);
            console.log('Words Data:', wordsData);
            populateSuraSelector();
            loadSelections();  // Load the saved selections when page reloads
        }).catch(error => {
            console.error('Error loading JSON files:', error);
        });
        
        // Populate Sura Selector
        function populateSuraSelector() {
            const suraSelect = document.getElementById('sura-select');
            suraSelect.innerHTML = '';
            for (let suraNumber in suraData) {
                const option = document.createElement('option');
                option.value = suraNumber;
                option.textContent = suraNumber + '. ' + suraData[suraNumber].name;
                suraSelect.appendChild(option);
            }
            suraSelect.addEventListener('change', () => {
                saveSelections();  // Save the selections whenever Sura is changed
                populateVerseSelector();
                goToSelectedVerse();  // Automatically display verses when Sura changes
            });
            populateVerseSelector(); // Populate verses for the first sura initially
        }
        
        // Populate Verse Selector based on selected sura with local verse numbering
        function populateVerseSelector() {
            const suraNumber = document.getElementById('sura-select').value;
            const verseSelect = document.getElementById('verse-select');
            const sura = suraData[suraNumber];
            verseSelect.innerHTML = '';
        
            // Loop through the verses of the sura and show local verse numbers
            for (let verseNumber = sura.start; verseNumber <= sura.end; verseNumber++) {
                const option = document.createElement('option');
                const localVerseNumber = verseNumber - sura.start + 1; // Calculate local verse number
                option.value = verseNumber;
                option.textContent = localVerseNumber; // Display the local verse number in the selector
                verseSelect.appendChild(option);
            }
        
            verseSelect.addEventListener('change', () => {
                saveSelections();  // Save the selections when Verse is changed
                goToSelectedVerse();  // Automatically display the selected verse
            });
        }
        
        // Display the selected sura and its verses with local verse numbering
        function displaySura(suraNumber, targetVerse = null) {
            const sura = suraData[suraNumber];
            const container = document.getElementById('quran-container');
            container.innerHTML = `<h4>${suraNumber}. ${sura.name}</h4>`;
        
            // Loop through the verses in the sura
            for (let verseNumber = sura.start; verseNumber <= sura.end; verseNumber++) {
                const verseData = combinedData[verseNumber];
                const constructedArabic = buildVerseFromWords(verseData.start_word, verseData.end_word);
        
                // Calculate the local verse number
                const localVerseNumber = verseNumber - sura.start + 1;
        
                // Display the verse
                const verseDiv = document.createElement('div');
                verseDiv.className = 'verse';
                verseDiv.innerHTML = `
                    <h5>${localVerseNumber}</h5>  <!-- Display local verse number -->
                    <span id="${localVerseNumber}" class="arabic">${constructedArabic}</span>
                `;
                container.appendChild(verseDiv);
        
                // Scroll to the selected verse, if specified
                if (targetVerse && parseInt(targetVerse) === verseNumber) {
                    verseDiv.scrollIntoView({ behavior: 'smooth' });
                }
            }
        }
        
        // Navigate to the selected sura and verse
        function goToSelectedVerse() {
            const suraNumber = document.getElementById('sura-select').value;
            const verseNumber = document.getElementById('verse-select').value;
            displaySura(suraNumber, verseNumber);
        }
        
        // Build a verse using the word indices from quran_words.json
        function buildVerseFromWords(startIndex, endIndex) {
            const words = [];
            for (let i = startIndex; i <= endIndex; i++) {
                words.push('<span id="'+i+'">'+wordsData[i] + "</span>");
            }
            return words.join(' ');
        }
        
        // Save selected Sura and Verse to localStorage
        function saveSelections() {
            const suraSelect = document.getElementById('sura-select');
            const verseSelect = document.getElementById('verse-select');
            localStorage.setItem('selectedSura', suraSelect.value);
            localStorage.setItem('selectedVerse', verseSelect.value);
        }
        
        // Load the saved selections from localStorage when the page reloads
        function loadSelections() {
            const savedSura = localStorage.getItem('selectedSura');
            const savedVerse = localStorage.getItem('selectedVerse');
        
            const suraSelect = document.getElementById('sura-select');
            const verseSelect = document.getElementById('verse-select');
        
            if (savedSura) {
                suraSelect.value = savedSura;
                populateVerseSelector();  // Update verse selector based on saved Sura
                if (savedVerse) {
                    verseSelect.value = savedVerse;
                }
            }
        
            // Automatically display the saved sura and verse
            displaySura(suraSelect.value, verseSelect.value);
        }
        </script>
        
        

</body>
</html>
